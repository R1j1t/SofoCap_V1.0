<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
        <title>Bdtask - Bootstrap Admin Template Dashboard</title>

        <!-- Favicon and touch icons -->
        <link rel="shortcut icon" href="/assets/dist/img/ico/favicon.png" type="image/x-icon">
        <link rel="apple-touch-icon" type="image/x-icon" href="/assets/dist/img/ico/apple-touch-icon-57-precomposed.png">
        <link rel="apple-touch-icon" type="image/x-icon" sizes="72x72" href="/assets/dist/img/ico/apple-touch-icon-72-precomposed.png">
        <link rel="apple-touch-icon" type="image/x-icon" sizes="114x114" href="/assets/dist/img/ico/apple-touch-icon-114-precomposed.png">
        <link rel="apple-touch-icon" type="image/x-icon" sizes="144x144" href="/assets/dist/img/ico/apple-touch-icon-144-precomposed.png">

        <!-- Start Global Mandatory Style
        =====================================================================-->
        <!-- jquery-ui css -->
        <link href="/assets/plugins/jquery-ui-1.12.1/jquery-ui.min.css" rel="stylesheet" type="text/css"/>
        <!-- Bootstrap -->
        <link href="/assets/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
        <!-- Bootstrap rtl -->
        <!--<link href="assets/bootstrap-rtl/bootstrap-rtl.min.css" rel="stylesheet" type="text/css"/>-->
        <!-- Lobipanel css -->
        <link href="/assets/plugins/lobipanel/lobipanel.min.css" rel="stylesheet" type="text/css"/>
        <!-- Pace css -->
        <link href="/assets/plugins/pace/flash.css" rel="stylesheet" type="text/css"/>
        <!-- Font Awesome -->
        <link href="/assets/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css"/>
        <!-- Pe-icon -->
        <link href="/assets/pe-icon-7-stroke/css/pe-icon-7-stroke.css" rel="stylesheet" type="text/css"/>
        <!-- Themify icons -->
        <link href="/assets/themify-icons/themify-icons.css" rel="stylesheet" type="text/css"/>
        <!-- End Global Mandatory Style
        =====================================================================-->
        <!-- Start Theme Layout Style
        =====================================================================-->
        <!-- Theme style -->
        <link href="/assets/dist/css/styleBD.css" rel="stylesheet" type="text/css"/>
        <!-- Theme style rtl -->
        <!--<link href="/assets/dist/css/styleBD-rtl.css" rel="stylesheet" type="text/css"/>-->
        <!-- End Theme Layout Style
        =====================================================================-->
        <style>
            @media screen and (min-width: 768px) {
	
                #myModal .modal-dialog  {width:1000px;}

            }
        </style>
    </head>
    <body class="hold-transition sidebar-mini">
        <!-- Site wrapper -->
        <div class="wrapper">
            <header class="main-header"> 
                <a href="#" class="logo"> <!-- Logo -->
                    <span class="logo-mini">
                        <!--<b>A</b>BD-->
                        <img src="/assets/dist/img/mini-logo.png" alt="">
                    </span>
                    <span class="logo-lg">
                        <!--<b>Admin</b>BD-->
                        <img src="/assets/dist/img/logo.png" alt="">
                    </span>
                </a>
                <!-- Header Navbar -->
                <nav class="navbar navbar-static-top">
                    <a href="#" class="sidebar-toggle" data-toggle="offcanvas" role="button"> <!-- Sidebar toggle button-->
                        <span class="sr-only">Toggle navigation</span>
                        <span class="pe-7s-keypad"></span>
                    </a>
                    <div class="navbar-custom-menu">
                        <ul class="nav navbar-nav">
                            <li class="dropdown dropdown-user">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown"> <i class="fa fa-user-circle-o v-middle" aria-hidden="true"></i></a>
                                <ul class="dropdown-menu">
                                   <!-- <li><a href="profile.html"><i class="pe-7s-users"></i> User Profile</a></li>
                                    <li><a href="#"><i class="pe-7s-settings"></i> Settings</a></li>-->
                                    <li><a href="/logout"><i class="pe-7s-key"></i> Logout</a></li>
                                </ul>
                            </li>
                        </ul>
                    </div>
                </nav>
            </header>
            <!-- =============================================== -->
            <!-- Left side column. contains the sidebar -->
            <%if (user=='OEM'){%>
                <% include partials/oem-navigation %>
            <%}else {%>
                <% include partials/user-navigation %>
            <%}%>
           
            <!-- =============================================== -->
            <!-- Content Wrapper. Contains page content -->
            <div class="content-wrapper">
                <!-- Main content -->
                <section class="content" style="margin-top:15px;">
                    <div class="row">
                         <!-- Modal -->
<div class="modal fade" id="myModal1" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">View History</h4>
      </div>
      <div class="modal-body">
          <input type="hidden" name="smartcodeAddress" id="smartcodeAddress" value="">
        <table class="table no-border" style="margin-bottom:15px;">
        	<tbody>
                
            	<tr>
                	<td>Smart Code Address</td>
                    <td>0001</td>
                </tr>
                <tr>
                	<td>Owner</td>
                    <td>Prolitus</td>
                </tr>
            </tbody>
        </table>
        <table class="table table-bordered">
        	<tbody>
            	<tr>
                	<td style="border:none;">Owner</td>
                    <td>Time</td>
                </tr>
                <tr>
                	<td>Prolitus</td>
                    <td>15/06/2017</td>
                </tr>
            </tbody>
        </table>
      </div>
     <!-- <div class="modal-footer">
        <button type="button" class="btn btn-primary">View Sub Unit</button>
      </div>-->
    </div>
  </div>
</div>

                        <!-- Textual inputs -->
                        <div class="col-sm-12">
                            <div class="panel panel-bd unit-maneg-page">
                                <div class="panel-heading clearfix">
                                   <div class="panel-title pull-left">
                                        <h2>Explorer</h2>
                                    </div>
                                   
                                </div>
                                


                                <div class="row">
                      <div class="col-sm-6">
                            <div class="panel panel-bd">
                                <div class="panel-heading">
                                    <div class="panel-title">
                                        <h4>Block Search</h4>
                                    </div>
                                </div>
                                <div class="panel-body">
                                        <div class="form-group"><input class="form-control col-sm-9" id="blockNum" name="blockNum" type="text" style="width: 650px;" placeholder="Enter Block Number"></div>
                                        <a href="javascript:;" id="blockNumSearch" name="blockNumSearch" class="btn btn-primary btn-xs btnFindBlock">View</a>
                                        
                                    
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="panel panel-bd">
                                <div class="panel-heading">
                                    <div class="panel-title">
                                        <h4>Transaction Search</h4>
                                    </div>
                                </div>
                                <div class="panel-body">
                                    <form class="form-inline">
                                        <div class="form-group"><input class="form-control col-sm-9" id="transacId" name="transacId" type="text" style="width: 650px;" placeholder="Enter Transaction Id"></div>
                                        <a href="javascript:;" id="transacSearch" name="transacSearch" class="btn btn-primary btn-xs btnFindTx">View</a>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
                            <div class="panel panel-bd">
                                <div class="panel-heading">
                                    <div class="panel-title">
                                        <h4>Recent Blocks</h4>
                                    </div>
                                </div>
                                <div class="panel-body">
                                    <div class="table-responsive">
                                        <table  class="table table-striped">
                                            <thead>
                                                <tr>
                                                    <th>Block#</th>
                                                    <th>State Hash</th>
                                                    <th>Previous Hash</th>
                                                    
                                                    <th>Log</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <% for (var i=0;i<data.blockList.length;i++){%>
                                                <tr>
                                                    <td><%=data.blockList[i].number%></td>
                                                    <td><%=data.blockList[i].dataHash.slice(0,12)%>...</td>
                                                    <td><%=data.blockList[i].previous_hash.slice(0,12)%>...</td>
                                                    
                                                    <td>
                                                        <a href="javascript:;" id="<%=data.blockList[i].number%>###<%=data.blockList[i].dataHash%>###<%=data.blockList[i].previous_hash%>###<%=data.blockList[i].transactionNum%>###<%=i%>" class="btn btn-primary btn-xs btnViewBlock">View</a>
                                                        
                                                </tr>
                                                <%}%>
                                                
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
                            <div class="panel panel-bd">
                                <div class="panel-heading">
                                    <div class="panel-title">
                                        <h4>Current State-</h4>
                                    </div>
                                </div>
                                <div class="panel-body">
                                    <div class="text-center">
                                    <b><font size="7"><%=data.currentState.blockHeight%></font></b>
                                    <br>Blocks
                                    </div>
                                    <br><b><h4 >Current Block Hash-</h4><%=data.currentState.currentBlockHash%></b>
                                    <br><b><h4>Previous Block Hash-</h4><%=data.currentState.previousBlockHash%></b>            

                                </div>
                            </div>
                        </div>

                        


                    </div>
                    <div class="row">
                        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                            <div class="panel panel-bd">
                                <div class="panel-heading">
                                    <div class="panel-title">
                                        <h4>Latest Transactions</h4>
                                    </div>
                                </div>
                                <div class="panel-body">
                                    <div class="table-responsive">
                                        <table  class="table table-striped">
                                            <thead>
                                                <tr>
                                                    <th>Transaction ID</th>
                                                    <th>Timestamp</th>
                                                    <th>Log</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <%for (var i=0;i<data.txArray.length;i++){%>
                                                <tr>
                                                    <td><%=data.txArray[i].id%></td>
                                                    <td><%=data.txArray[i].timeStamp%></td>
                                                    <td>
                                                        <a href="javascript:;" id="<%=data.txArray[i].id%>###<%=data.txArray[i].timeStamp%>###<%=data.txArray[i].nonce%>###<%=data.txArray[i].certificate%>###<%=data.txArray[i].signature%>" class="btn btn-primary btn-xs btnViewTansaction">View</a>
                                                       
                                                        </td>
                                                </tr>
                                                <%}%>
                                            </tbody>
                                        </table>
                                        
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>











                                
                            </div>
                        </div>
                    </div>
                    <!-- Checkboxes & Radios -->
                </section> <!-- /.content -->
            </div> <!-- /.content-wrapper -->
            <footer class="main-footer">
                <div class="pull-right hidden-xs"> <b>Version</b> 1.0</div>
                <strong>Copyright &copy; 2016-2017 <a href="#">bdtask</a>.</strong> All rights reserved. <i class="fa fa-heart color-green"></i>
            </footer>
        </div> <!-- ./wrapper -->
         <div class="modal fade" id="myModal" tabindex="-1" role="dialog">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h1 class="modal-title">Transaction data</h1>
                    </div>
                    <div class="modal-body">
                        
                        <div>
                            
                            <span id="payload" name="payload" style="overflow-wrap: break-word;"></span><br>
                            <span style="color:darkolivegreen;font-weight:bold">Txn ID</span><br>
                            <span id="txid" name="txid" style="overflow-wrap: break-word;"></span><br>
                            <span style="color:darkolivegreen;font-weight:bold">Timestamp</span><br>
                            <span id="timestamp" name="timestamp" style="overflow-wrap: break-word;"></span><br>
                            <span style="color:darkolivegreen;font-weight:bold">Nonce</span><br>
                            <span id="nonce" name="nonce" style="overflow-wrap: break-word;"></span><br>
                            <span style="color:darkolivegreen;font-weight:bold">Cert</span><br>
                            <span id="cert" name="cert" style="overflow-wrap: break-word;"></span><br>
                            <span style="color:darkolivegreen;font-weight:bold">Signature</span><br>
                            <span id="signature" name="signature" style="overflow-wrap: break-word;"></span><br>
                        </div>

                        
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                       
                    </div>
                </div><!-- /.modal-content -->
            </div><!-- /.modal-dialog -->
        </div>
        <div class="modal fade" id="myModal2" tabindex="-1" role="dialog">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h1 class="modal-title">Block data</h1>
                    </div>
                    <div class="modal-body">
                        <input type="hidden" name="BlockId" id="BlockId" value="">
                        
                        <div>
                            
                            <span style="color:darkolivegreen;font-weight:bold">Block Number</span><br>
                            <span id="number" name="number" style="overflow-wrap: break-word;"></span><br>
                            <span style="color:darkolivegreen;font-weight:bold">Txn Hash</span><br>
                            <span id="previousHash" name="previousHash" style="overflow-wrap: break-word;"></span><br>
                            <span style="color:darkolivegreen;font-weight:bold">Data Hash</span><br>
                            <span id="dataHash" name="dataHash" style="overflow-wrap: break-word;"></span><br>
                            <span style="color:darkolivegreen;font-weight:bold">Txn Count</span><br>
                            <span id="txCount" name="txCount" style="overflow-wrap: break-word;"></span><br>
                            <div class="text-center">
                            <h2>Transactions</h2>
                            </div>
                            <p>Change here</p>
                            
                        </div>
                        
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                       
                    </div>
                </div><!-- /.modal-content -->
            </div><!-- /.modal-dialog -->
        </div>
        <!-- Start Core Plugins
        =====================================================================-->
        <!-- jQuery -->
        <script src="/assets/plugins/jQuery/jquery-1.12.4.min.js" type="text/javascript"></script>
        <!-- jquery-ui --> 
        <script src="/assets/plugins/jquery-ui-1.12.1/jquery-ui.min.js" type="text/javascript"></script>
        <!-- Bootstrap -->
        <script src="/assets/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
        <!-- lobipanel -->
        <script src="/assets/plugins/lobipanel/lobipanel.min.js" type="text/javascript"></script>
        <!-- Pace js -->
        <script src="/assets/plugins/pace/pace.min.js" type="text/javascript"></script>
        <!-- SlimScroll -->
        <script src="/assets/plugins/slimScroll/jquery.slimscroll.min.js" type="text/javascript"></script>
        <!-- FastClick -->
        <script src="/assets/plugins/fastclick/fastclick.min.js" type="text/javascript"></script>
        <!-- AdminBD frame -->
        <script src="/assets/dist/js/frame.js" type="text/javascript"></script>
        <!-- End Core Plugins
        =====================================================================-->
        <!-- Start Theme label Script
        =====================================================================-->
        <!-- Dashboard js -->
        <script src="/assets/dist/js/dashboard.js" type="text/javascript"></script>
        <!-- End Theme label Script
        =====================================================================-->
        <script>
            
            $(document).ready(function () {

                "use strict"; // Start of use strict

                $(".btnViewTansaction").click(function () {
                    var Data=$(this).attr("id").split("###");
                    
                                
                                $("#txid").text(Data[0]);
                                $("#timestamp").text(Data[1]);
                                $("#nonce").text(Data[2]);
                                $("#cert").text(Data[3]);
                                $("#signature").text(Data[4]);
                                //$("#chainId").val(data.chaincodeID);    
                                //alert( data.chaincodeID );
                                $('#myModal').modal('show');
                                
                   
                });
                
                $(".btnFindTx").click(function () {
                    
                    
                    var url = "/getTxById?txid="+$("#transacId").val();
                              
                                
                                $.get( url, function( data ) {
                                    console.log("TX-",data.id)
                                    if (data.id&&data.id.length>0){
                                $("#txid").text(data.id);
                                $("#timestamp").text(data.timeStamp);
                                $("#nonce").text(data.nonce);
                                $("#cert").text(data.certificate);
                                $("#signature").text(data.signature);
                                //$("#chainId").val(data.chaincodeID);    
                                //alert( data.chaincodeID );
                                
                                
                                $('#myModal').modal('show');
                                    }else{
                                        alert ("No such transaction recorded.")
                                    }
                                });
                });

                $(".btnFindBlock").click(function () {
                    
                    
                    var url = "/getBlockByNumber?number="+$("#blockNum").val();
                              
                                
                                $.get( url, function( data ) {
                                    console.log("blockNumber",data.dataHash);
                                    if (data.dataHash&&data.dataHash.length>0){

                                    
                                     var output='';
                                for (var i=0;i<data.transactions.length;i++){
                                        output+='<span style="color:darkolivegreen;font-weight:bold">Txn ID</span><br><span id="blockTXtxid"  name="blockTXtxid" style="overflow-wrap: break-word;">'+data.transactions[i].id+'</span><br>                            <span style="color:darkolivegreen;font-weight:bold">Timestamp</span><br>                            <span id="blockTXtimestamp"  name="blockTXtimestamp" style="overflow-wrap: break-word;">'+data.transactions[i].timeStamp+'</span><br>                            <span style="color:darkolivegreen;font-weight:bold">Nonce</span><br>                            <span id="blockTXnonce" name="blockTXnonce" style="overflow-wrap: break-word;">'+data.transactions[i].nonce+'</span><br>                            <span style="color:darkolivegreen;font-weight:bold">Cert</span><br>                            <span id="blockTXcert" name="blockTXcert" style="overflow-wrap: break-word;">'+data.transactions[i].certificate+'</span><br>                            <span style="color:darkolivegreen;font-weight:bold">Signature</span><br>                            <span id="blockTXsignature" name="blockTXsignature" style="overflow-wrap: break-word;">'+data.transactions[i].signature+'</span><br>'
                                    
                                    }
                                $("p").html(output);
                                $("#number").text(data.number);
                                $("#dataHash").text(data.dataHash);
                                $("#previousHash").text(data.previous_hash);
                                $("#txCount").text(data.transactionNum);
                                //$("#chainId").val(data.chaincodeID);    
                                //alert( data.chaincodeID );
                                $('#myModal2').modal('show');
                                }else{
                                    alert("No such block recorded yet");
                                }
                                });
                });
                $(".btnViewBlock").click(function () {
                    var Data=$(this).attr("id").split("###");
                                
                                
                                $("#number").text(Data[0]);
                                $("#dataHash").text(Data[1]);
                                $("#previousHash").text(Data[2]);
                                $("#txCount").text(Data[3]);
                                var output='';
                                
                                
                                
                                    var url = "/getBlockByNumber?number="+Data[0];
                                
                                
                                $.get( url, function( data ) {
                                    console.log("blockNumber",data);
                                for (var i=0;i<data.transactions.length;i++){
                                        output+='<span style="color:darkolivegreen;font-weight:bold">Txn ID</span><br><span id="blockTXtxid"  name="blockTXtxid" style="overflow-wrap: break-word;">'+data.transactions[i].id+'</span><br>                            <span style="color:darkolivegreen;font-weight:bold">Timestamp</span><br>                            <span id="blockTXtimestamp"  name="blockTXtimestamp" style="overflow-wrap: break-word;">'+data.transactions[i].timeStamp+'</span><br>                            <span style="color:darkolivegreen;font-weight:bold">Nonce</span><br>                            <span id="blockTXnonce" name="blockTXnonce" style="overflow-wrap: break-word;">'+data.transactions[i].nonce+'</span><br>                            <span style="color:darkolivegreen;font-weight:bold">Cert</span><br>                            <span id="blockTXcert" name="blockTXcert" style="overflow-wrap: break-word;">'+data.transactions[i].certificate+'</span><br>                            <span style="color:darkolivegreen;font-weight:bold">Signature</span><br>                            <span id="blockTXsignature" name="blockTXsignature" style="overflow-wrap: break-word;">'+data.transactions[i].signature+'</span><br>'
                                    
                                    }
                                $("p").html(output);
                                //$("#chainId").val(data.chaincodeID);    
                                //alert( data.chaincodeID );
                                $('#myModal2').modal('show');
                                });
                });
            });
            

        </script>
        <script>
            $(function () {
                $("#datepicker").datepicker({
                    dateFormat: "dd-mm-yy"
                });
            });
        </script>
        
    </body>
</html>